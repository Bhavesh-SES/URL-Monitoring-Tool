<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>URL Playback Monitor</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      transition: background 0.3s, color 0.3s;
    }

    body.light {
      background: #f9f9f9;
      color: #222;
    }

    body.dark {
      background: #121212;
      color: #eee;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #333;
      color: #fff;
    }

    .theme-toggle {
      padding: 5px 10px;
      cursor: pointer;
    }

    .controls {
      text-align: center;
      padding: 20px;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      padding: 10px;
    }

    .player-box {
      width: 400px;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }

    body.dark .player-box {
      background: #1e1e1e;
    }

    video, iframe {
      width: 100%;
      height: 225px;
      background: black;
    }

    .alert {
      color: red;
      padding: 5px;
      text-align: center;
      font-size: 0.85em;
    }

    input[type="file"] {
      margin: 10px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body class="light">

  <header>
    <div><strong>URL Monitor Tool</strong></div>
    <button class="theme-toggle" onclick="toggleTheme()">üåó Toggle Theme</button>
  </header>

  <div class="controls">
    <label>Rows: <input type="number" id="rows" value="2" min="1"></label>
    <label>Columns: <input type="number" id="cols" value="2" min="1"></label>
    <label>Auto Refresh (min): <input type="number" id="refresh" value="1" min="1"></label>
    <br><br>
    <input type="file" id="csvFile" accept=".csv">
    <p>Or drag and drop CSV anywhere on page</p>
  </div>

  <div class="grid" id="grid"></div>

  <audio id="alertSound" src="alert.mp3" preload="auto"></audio>

  <script>
    let videoData = [];
    let refreshInterval;
    const grid = document.getElementById("grid");

    document.body.addEventListener("dragover", e => e.preventDefault());
    document.body.addEventListener("drop", e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file && file.type === "text/csv") loadCSV(file);
    });

    document.getElementById("csvFile").addEventListener("change", function () {
      const file = this.files[0];
      if (file) loadCSV(file);
    });

    function loadCSV(file) {
      Papa.parse(file, {
        header: false,
        skipEmptyLines: true,
        complete: function (results) {
          videoData = results.data;
          buildGrid();
          setupAutoRefresh();
        }
      });
    }

    function buildGrid() {
      const rows = parseInt(document.getElementById("rows").value);
      const cols = parseInt(document.getElementById("cols").value);
      const maxBoxes = rows * cols;
      const neededBoxes = videoData.length;
      const totalBoxes = Math.max(maxBoxes, neededBoxes);

      grid.innerHTML = '';

      for (let i = 0; i < totalBoxes; i++) {
        const box = document.createElement("div");
        box.className = "player-box";
        box.id = `box-${i}`;
        grid.appendChild(box);
      }

      loadPlayers();
    }

    function loadPlayers() {
      const alertSound = document.getElementById("alertSound");

      videoData.forEach(([name, url], i) => {
        const box = document.getElementById(`box-${i}`);
        if (!box) return;
        box.innerHTML = `<div><strong>${name}</strong></div><div class="media"></div><div class="alert" id="alert-${i}"></div>`;

        const mediaDiv = box.querySelector(".media");
        const alertDiv = box.querySelector(".alert");
        alertDiv.textContent = "";

        if (url.endsWith(".m3u8")) {
          const video = document.createElement("video");
          video.src = url;
          video.controls = true;
          video.autoplay = true;
          video.onerror = () => {
            alertDiv.textContent = "‚ö†Ô∏è Video error (HLS)";
            alertSound.play();
          };
          mediaDiv.appendChild(video);
        } else if (url.endsWith(".mpd")) {
          const video = document.createElement("video");
          video.controls = true;
          video.autoplay = true;
          video.onerror = () => {
            alertDiv.textContent = "‚ö†Ô∏è Video error (DASH)";
            alertSound.play();
          };
          dashjs.MediaPlayer().create().initialize(video, url, true);
          mediaDiv.appendChild(video);
        } else if (url.endsWith(".ism") || url.includes("manifest")) {
          const iframe = document.createElement("iframe");
          iframe.src = url;
          iframe.onerror = () => {
            alertDiv.textContent = "‚ö†Ô∏è iFrame error (Smooth)";
            alertSound.play();
          };
          mediaDiv.appendChild(iframe);
        } else {
          const iframe = document.createElement("iframe");
          iframe.src = url;
          iframe.onerror = () => {
            alertDiv.textContent = "‚ö†Ô∏è URL Load Failed";
            alertSound.play();
          };
          mediaDiv.appendChild(iframe);
        }
      });
    }

    function setupAutoRefresh() {
      clearInterval(refreshInterval);
      const mins = parseInt(document.getElementById("refresh").value) || 1;
      refreshInterval = setInterval(loadPlayers, mins * 60000);
    }

    function toggleTheme() {
      const body = document.body;
      body.classList.toggle("dark");
      body.classList.toggle("light");
    }
  </script>
</body>
</html>
